<package>

  <process id="close.bug">
    <parameter id="bugid"/>
    <action key="close.bug"/>
  </process>

  <process id="bug"
           xmlns="werkflow:idiomatic">

  <sequence>

    <receive type="bug" var="message">
      <jelly:action> 
      </jelly:action> 
    </receive>

    <jelly:action>
       .. stuff the bug into the database ..
    </jelly:action>

    <parallel>
      <while condition="${true}">

        <if condition="${status=new}">
        </if>

        <if condition="${status=open}">
          <pick>
            <on-message type="status[close]">
              <process:action id="close.bug">
                <in  var="foo" value="${...}"/>
                <out var="foo" value="${...}"/>
              </process:action>
   
            </on-message>
          </pick>
        </if>

        <pick>
          <on-message type="status[verified]">
            <pick>
              <on-message type="status[resolved]">
                <pick>
                  <on-message type="status[closed]">
                    <terminate/>
                  </on-message>
                </pick>
              </on-message>
            </pick>
          </on-message>
          <on-message type="status[closed-duplicate]">
            <terminate/>
          </on-message>
        </pick>
      </while>
      <while condition="${true}">
        <receive type="comment[add]"/>
      </while>
      <while condition="${true}">
        <receive type="attachment[add]"/>
      </while>
    <parallel>

  </sequence>

</process>
