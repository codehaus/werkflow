
<process id="blog"
         initiation="message"
         xmlns="werkflow:basic"
         xmlns:j="jelly:core"
         xmlns:java="jelly:com.werken.werkflow.semantics.java.JavaTagLibrary"
         xmlns:jelly="jelly:com.werken.werkflow.semantics.jelly.JellyTagLibrary"
         xmlns:python="jelly:com.werken.werkflow.semantics.python.PythonTagLibrary">

    <message-types>
        <message-type id="blog.entry">
            <python:selector type="com.werken.werkflow.example.blog.BlogEntry"/>
        </message-type>
        <message-type id="publish.cmd">
            <python:selector type="com.werken.werkflow.example.blog.Command" 
                           filter="message.getType() == 'publish'"/>
        </message-type>
        <message-type id="reject.cmd">
            <python:selector type="com.werken.werkflow.example.blog.Command" 
                             filter="message.getType() == 'reject'"/>
        </message-type>
    </message-types>

    <attributes>
        <attribute id="author"> 
            <java:attr-type type="java.lang.String"/>
        </attribute>
        <attribute id="title"> 
            <java:attr-type type="java.lang.String"/>
        </attribute>
    </attributes>

    <sequence>
        <receive type="blog.entry">
            <jelly:action>
                <j:set var="title" value="${message.title}"/>
                <j:set var="author" value="${message.author}"/>
            </jelly:action>
        </receive>
        <jelly:log message="received: ${title} by ${author}"/>
        <pick>
            <choice>
                <sequence>
                    <receive type="publish.cmd" bind="cmd">
                        <python:correlator test="cmd.title == title"/>
                        <jelly:action>
                            <j:set var="cmdTitle" value="${cmd.title}"/>
                        </jelly:action>
                    </receive>
                    <jelly:log message="publishing ${title}"/>
                </sequence>
            </choice>
            <choice>
                <sequence>
                    <receive type="reject.cmd" bind="cmd">
                        <python:correlator test="cmd.title == title"/>
                        <jelly:action>
                            <j:set var="cmdTitle" value="${cmd.title}"/>
                        </jelly:action>
                    </receive>
                    <jelly:log message="rejecting ${title}"/>
                </sequence>
            </choice>
        </pick>
    </sequence>

</process>
